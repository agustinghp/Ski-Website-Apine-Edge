<div class="container mt-5">
    {{#if error}}
        <div class="alert alert-danger">{{error}}</div>
    {{else}}
        <div class="row">
            <!-- Image Section -->
            <div class="col-md-6">
                {{#if images}}
                    {{#if (eq images.length 1)}}
                        <!-- Single image -->
                        <img src="{{images.[0].image_path}}" class="img-fluid rounded" alt="{{service.servicename}}">
                    {{else}}
                        <!-- Image carousel for multiple images -->
                        <div id="serviceCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                {{#each images}}
                                    <button type="button" data-bs-target="#serviceCarousel" 
                                            data-bs-slide-to="{{@index}}" 
                                            {{#if @first}}class="active"{{/if}}></button>
                                {{/each}}
                            </div>
                            <div class="carousel-inner">
                                {{#each images}}
                                    <div class="carousel-item {{#if @first}}active{{/if}}">
                                        <img src="{{image_path}}" class="d-block w-100 rounded" alt="Service image {{@index}}">
                                    </div>
                                {{/each}}
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#serviceCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#serviceCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </button>
                        </div>
                    {{/if}}
                {{else}}
                    <!-- Placeholder if no images -->
                    <div class="bg-light d-flex align-items-center justify-content-center rounded" style="height: 400px;">
                        <div class="text-center text-muted">
                            <i class="bi bi-briefcase" style="font-size: 4rem;"></i>
                            <p>No image available</p>
                        </div>
                    </div>
                {{/if}}
            </div>

            <!-- Service Details Section -->
            <div class="col-md-6">
                <span class="badge bg-info text-dark mb-2">Service</span>
                <h1>{{service.servicename}}</h1>
                
                {{#if service.price}}
                    <h3 class="text-success">${{service.price}}</h3>
                {{else}}
                    <h5 class="text-muted">Contact for Pricing</h5>
                {{/if}}

                {{#if service.servicedescription}}
                    <div class="mb-3">
                        <h5>Description</h5>
                        <p>{{service.servicedescription}}</p>
                    </div>
                {{/if}}

                <hr>

                <!-- Provider Information -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Service Provider</h5>
                        <div class="d-flex align-items-center mb-2">
                            {{#if provider.profile_image}}
                                <img src="{{provider.profile_image}}" alt="{{provider.username}}" 
                                     class="rounded-circle me-2" style="width: 50px; height: 50px; object-fit: cover;">
                            {{else}}
                                <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center me-2" 
                                     style="width: 50px; height: 50px;">
                                    <span class="fs-5">{{substring provider.username 0 1}}</span>
                                </div>
                            {{/if}}
                            <div>
                                <a href="/users/{{provider.id}}" class="text-decoration-none">
                                    <strong>{{provider.username}}</strong>
                                </a>
                                <br>
                                <small class="text-muted">
                                    <i class="bi bi-geo-alt"></i> {{provider.location}}
                                </small>
                            </div>
                        </div>
                        <small class="text-muted">Member since {{formatDate provider.created_at}}</small>
                    </div>
                </div>

                <!-- Action Buttons -->
                {{#if userId}}
                    {{#if isOwner}}
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle"></i> This is your listing
                        </div>
                    {{else}}
                        {{#if (eq connectionStatus 'accepted')}}
                            <a href="/chat?userId={{provider.id}}" class="btn btn-success w-100">
                                <i class="bi bi-chat-dots"></i> Message Provider
                            </a>
                        {{else if (eq connectionStatus 'pending')}}
                            <button class="btn btn-secondary w-100" disabled>
                                Connection Request Pending
                            </button>
                        {{else}}
                            <a href="/users/{{provider.id}}" class="btn btn-primary w-100">
                                View Provider Profile
                            </a>
                        {{/if}}
                    {{/if}}
                {{else}}
                    <a href="/login" class="btn btn-primary w-100">Login to Contact Provider</a>
                {{/if}}
            </div>
        </div>
    {{/if}}
</div>
