<div class="container my-4">
    <p class="text-muted">Joined: {{formatDate user.created_at}}</p>
    <p><strong>Location:</strong> {{user.location}}</p>

    {{!-- Email logic --}}
    {{#if showEmail}}
    <p><strong>Email:</strong> {{user.email}}</p>
    {{/if}}


    <hr>

    {{!-- Connection Buttons --}}
    <div class="mt-3">

        {{!-- 1. ACCEPTED CONNECTION --}}
        {{#if (eq connectionStatus "accepted")}}

        {{!-- Only show buttons if viewing someone else --}}
        {{#unless (eq user.id ../userId)}}
        <div class="d-flex gap-2 mt-2">

            <a href="/chat?user={{user.id}}" class="btn btn-primary">
                Message
            </a>

            <form method="POST" action="/users/{{user.id}}/delete-connection">
                <button class="btn btn-danger" type="submit">
                    Delete Connection
                </button>
            </form>

        </div>
        {{/unless}}

        {{!-- 2. PENDING (you sent) --}}
        {{else}}
        {{#if (and (eq connectionStatus "pending") isRequester)}}
        <button class="btn btn-secondary" disabled>Request Sent</button>

        {{!-- 3. PENDING (they sent) --}}
        {{else}}
        {{#if (and (eq connectionStatus "pending") (not isRequester))}}
        <form method="POST" action="/users/{{user.id}}/accept" style="display:inline;">
            <button class="btn btn-success">Accept</button>
        </form>

        <form method="POST" action="/users/{{user.id}}/decline" style="display:inline;">
            <button class="btn btn-outline-danger">Decline</button>
        </form>

        {{!-- 4. DECLINED --}}
        {{else}}
        {{#if (eq connectionStatus "declined")}}

        {{!-- If YOU were the requester → they declined you --}}
        {{#if isRequester}}
        <p class="text-danger fw-semibold">This user declined your request.</p>

        {{!-- If THEY were the requester → you declined them --}}
        {{else}}
        <p class="text-warning fw-semibold">You declined this user.</p>

        <form method="POST" action="/users/{{user.id}}/request-again">
            <button class="btn btn-primary mt-2">Send Request Again</button>
        </form>
        {{/if}}

        {{!-- 5. NO CONNECTION --}}
        {{else}}
        {{#unless (eq user.id ../userId)}}
        <form method="POST" action="/users/{{user.id}}/request">
            <button class="btn btn-primary">Connect</button>
        </form>
        {{/unless}}
        {{/if}}

        {{/if}}
        {{/if}}
        {{/if}}

    </div>


    <hr class="my-4">

    <h3>Listings</h3>

    <h4 class="mt-3">Products</h4>

    {{#if products.length}}
    <div class="list-group mb-4">
        {{#each products}}
        <a href="/products/{{id}}" class="list-group-item list-group-item-action">
            <strong>{{productname}}</strong> — ${{price}}
        </a>
        {{/each}}
    </div>
    {{else}}
    <p class="text-muted">No products listed.</p>
    {{/if}}

    <h4 class="mt-3">Services</h4>

    {{#if services.length}}
    <div class="list-group">
        {{#each services}}
        <a href="/services/{{id}}" class="list-group-item list-group-item-action">
            <strong>{{servicename}}</strong> — ${{price}}
        </a>
        {{/each}}
    </div>
    {{else}}
    <p class="text-muted">No services listed.</p>
    {{/if}}



</div>