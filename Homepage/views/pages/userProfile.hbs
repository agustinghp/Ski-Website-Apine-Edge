<div class="container my-4">
    <p class="text-muted">Joined: {{formatDate user.created_at}}</p>
    <p><strong>Location:</strong> {{user.location}}</p>

    {{!-- Email logic --}}
    {{#if showEmail}}
    <p><strong>Email:</strong> {{user.email}}</p>
    {{/if}}


    <hr>

    {{!-- Connection Buttons --}}
    <div class="mt-3">

        {{!-- Accepted --}}
        {{#if (eq connectionStatus "accepted")}}
        <a href="/chat?user={{user.id}}" class="btn btn-primary">Message</a>

        {{!-- Pending (you sent) --}}
        {{else if (and (eq connectionStatus "pending") isRequester)}}
        <button class="btn btn-secondary" disabled>Request Sent</button>

        {{!-- Pending (they sent) --}}
        {{else if (and (eq connectionStatus "pending") (not isRequester))}}
        <form method="POST" action="/users/{{user.id}}/accept" style="display:inline;">
            <button class="btn btn-success">Accept</button>
        </form>

        <form method="POST" action="/users/{{user.id}}/decline" style="display:inline;">
            <button class="btn btn-outline-danger">Decline</button>
        </form>

        {{!-- Declined --}}
        {{else if (eq connectionStatus "declined")}}
        <p class="text-danger fw-semibold">Connection request was declined.</p>

        {{!-- Show "Connect Again" if YOU were the receiver --}}
        {{#if (not isRequester)}}
        <form method="POST" action="/users/{{user.id}}/request-again">
            <button class="btn btn-primary mt-2">Connect Again</button>
        </form>
        {{/if}}


        {{!-- No connection --}}
        {{else}}
        <form method="POST" action="/users/{{user.id}}/request">
            <button class="btn btn-primary">Connect</button>
        </form>
        {{/if}}

    </div>

    <hr class="my-4">

    <h3>Listings</h3>

    <h4 class="mt-3">Products</h4>

    {{#if products.length}}
    <div class="list-group mb-4">
        {{#each products}}
        <a href="/products/{{id}}" class="list-group-item list-group-item-action">
            <strong>{{productname}}</strong> — ${{price}}
        </a>
        {{/each}}
    </div>
    {{else}}
    <p class="text-muted">No products listed.</p>
    {{/if}}

    <h4 class="mt-3">Services</h4>

    {{#if services.length}}
    <div class="list-group">
        {{#each services}}
        <a href="/services/{{id}}" class="list-group-item list-group-item-action">
            <strong>{{servicename}}</strong> — ${{price}}
        </a>
        {{/each}}
    </div>
    {{else}}
    <p class="text-muted">No services listed.</p>
    {{/if}}



</div>