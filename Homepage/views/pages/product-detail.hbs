<!-- Updated product-detail.hbs with image display and delete functionality -->
<div class="container mt-5">
    {{#if error}}
        <div class="alert alert-danger">{{error}}</div>
    {{else}}
        <div class="row">
            <!-- Image Section -->
            <div class="col-md-6">
                {{#if images}}
                    {{#if (eq images.length 1)}}
                        <!-- Single image -->
                        <img src="{{images.[0].image_path}}" class="img-fluid rounded" alt="{{product.productname}}">
                    {{else}}
                        <!-- Image carousel for multiple images -->
                        <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                            <div class="carousel-indicators">
                                {{#each images}}
                                    <button type="button" data-bs-target="#productCarousel" 
                                            data-bs-slide-to="{{@index}}" 
                                            {{#if @first}}class="active"{{/if}}></button>
                                {{/each}}
                            </div>
                            <div class="carousel-inner">
                                {{#each images}}
                                    <div class="carousel-item {{#if @first}}active{{/if}}">
                                        <img src="{{image_path}}" class="d-block w-100 rounded" alt="Product image {{@index}}">
                                    </div>
                                {{/each}}
                            </div>
                            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon"></span>
                            </button>
                        </div>
                    {{/if}}
                {{else}}
                    <!-- Placeholder if no images -->
                    <div class="bg-light d-flex align-items-center justify-content-center rounded" style="height: 400px;">
                        <div class="text-center text-muted">
                            <i class="bi bi-image" style="font-size: 4rem;"></i>
                            <p>No image available</p>
                        </div>
                    </div>
                {{/if}}
            </div>

            <!-- Product Details Section -->
            <div class="col-md-6">
                <h1>{{product.productname}}</h1>
                
                <div class="mb-3">
                    <span class="badge bg-primary">{{product.brand}}</span>
                    <span class="badge bg-secondary">{{product.model}}</span>
                </div>

                <h3 class="text-success">${{product.price}}</h3>

                {{#if product.productdescription}}
                    <div class="mb-3">
                        <h5>Description</h5>
                        <p>{{product.productdescription}}</p>
                    </div>
                {{/if}}

                <div class="mb-3">
                    <h5>Specifications</h5>
                    <ul class="list-unstyled">
                        {{#if (eq product.producttype 'snowboard')}}
                            {{#if product.snowboardlength}}
                                <li><strong>Length:</strong> {{product.snowboardlength}} cm</li>
                            {{/if}}
                            {{#if product.snowboardwidth}}
                                <li><strong>Width:</strong> {{product.snowboardwidth}} mm</li>
                            {{/if}}
                        {{else if (eq product.producttype 'helmet')}}
                            {{#if product.helmetsize}}
                                <li><strong>Size:</strong> {{product.helmetsize}} cm</li>
                            {{/if}}
                        {{else if (eq product.producttype 'boots')}}
                            {{#if product.boottype}}
                                <li><strong>Type:</strong> {{#if (eq product.boottype 'ski')}}Ski Boots{{else}}Snowboard Boots{{/if}}</li>
                            {{/if}}
                            {{#if product.bootsize}}
                                <li><strong>Size:</strong> {{product.bootsize}} (US)</li>
                            {{/if}}
                        {{else if (eq product.producttype 'poles')}}
                            {{#if product.poleslength}}
                                <li><strong>Length:</strong> {{product.poleslength}} cm</li>
                            {{/if}}
                        {{else if (eq product.producttype 'goggles')}}
                            {{#if product.clothingsize}}
                                <li><strong>Size:</strong> {{product.clothingsize}}</li>
                            {{/if}}
                        {{else if (eq product.producttype 'gloves')}}
                            {{#if product.clothingsize}}
                                <li><strong>Size:</strong> {{product.clothingsize}}</li>
                            {{/if}}
                        {{else if (eq product.producttype 'jackets')}}
                            {{#if product.clothingsize}}
                                <li><strong>Size:</strong> {{product.clothingsize}}</li>
                            {{/if}}
                        {{else if (eq product.producttype 'pants')}}
                            {{#if product.clothingsize}}
                                <li><strong>Size:</strong> {{product.clothingsize}}</li>
                            {{/if}}
                        {{else if (eq product.producttype 'other')}}
                            <li><em>No specific specifications</em></li>
                        {{else}}
                            {{#if product.skilength}}
                                <li><strong>Length:</strong> {{product.skilength}} cm</li>
                            {{/if}}
                            {{#if product.skiwidth}}
                                <li><strong>Width:</strong> {{product.skiwidth}} mm</li>
                            {{/if}}
                        {{/if}}
                    </ul>
                </div>

                <hr>

                <!-- Seller Information -->
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Seller Information</h5>
                        <div class="d-flex align-items-center mb-2">
                            {{#if seller.profile_image}}
                                <img src="{{seller.profile_image}}" alt="{{seller.username}}" 
                                     class="rounded-circle me-2" style="width: 50px; height: 50px; object-fit: cover;">
                            {{else}}
                                <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center me-2" 
                                     style="width: 50px; height: 50px;">
                                    <span class="fs-5">{{substring seller.username 0 1}}</span>
                                </div>
                            {{/if}}
                            <div>
                                <a href="/users/{{seller.id}}" class="text-decoration-none">
                                    <strong>{{seller.username}}</strong>
                                </a>
                                <br>
                                <small class="text-muted">
                                    <i class="bi bi-geo-alt"></i> {{seller.location}}
                                </small>
                            </div>
                        </div>
                        <small class="text-muted">Member since {{formatDate seller.created_at}}</small>
                    </div>
                </div>

                <!-- Action Buttons -->
                {{#if userId}}
                    {{#if isOwner}}
                        <div class="alert alert-info mb-3">
                            <i class="bi bi-info-circle"></i> This is your listing
                        </div>
                        <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#deleteModal">
                            <i class="bi bi-trash"></i> Delete Listing
                        </button>
                    {{else}}
                        {{#if (eq connectionStatus 'accepted')}}
                            <a href="/chat?userId={{seller.id}}" class="btn btn-success w-100">
                                <i class="bi bi-chat-dots"></i> Message Seller
                            </a>
                        {{else if (eq connectionStatus 'pending')}}
                            <button class="btn btn-secondary w-100" disabled>
                                Connection Request Pending
                            </button>
                        {{else}}
                            <a href="/users/{{seller.id}}" class="btn btn-primary w-100">
                                View Seller Profile
                            </a>
                        {{/if}}
                    {{/if}}
                {{else}}
                    <a href="/login" class="btn btn-primary w-100">Login to Contact Seller</a>
                {{/if}}
            </div>
        </div>
    {{/if}}
</div>

<!-- Delete Confirmation Modal -->
{{#if isOwner}}
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this product listing? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form action="/products/{{product.id}}/delete" method="POST" style="display: inline;">
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>
{{/if}}
