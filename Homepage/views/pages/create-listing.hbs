<!-- Updated create-listing.hbs with image upload -->
<div class="container mt-5">
    <h1>Create a Listing</h1>

    {{#if message}}
    <div class="alert alert-{{message.type}} alert-dismissible fade show" role="alert">
        {{message.text}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {{/if}}

    <!-- Tabs for Product vs Service -->
    <ul class="nav nav-tabs mt-4" id="listingTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link {{#if (or (not listingType) (eq listingType 'product'))}}active{{/if}}" 
                    id="product-tab" data-bs-toggle="tab" data-bs-target="#product" 
                    type="button" role="tab">
                Product Listing
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link {{#if (eq listingType 'service')}}active{{/if}}" 
                    id="service-tab" data-bs-toggle="tab" data-bs-target="#service" 
                    type="button" role="tab">
                Service Listing
            </button>
        </li>
    </ul>

    <div class="tab-content mt-3" id="listingTabContent">
        
        <!-- PRODUCT LISTING FORM -->
        <div class="tab-pane fade {{#if (or (not listingType) (eq listingType 'product'))}}show active{{/if}}" 
             id="product" role="tabpanel">
            <form action="/create-listing/product" method="POST" enctype="multipart/form-data">
                
                <div class="mb-3">
                    <label for="brand" class="form-label">Brand *</label>
                    <input type="text" class="form-control" id="brand" name="brand" 
                           value="{{formData.brand}}" required>
                </div>

                <div class="mb-3">
                    <label for="model" class="form-label">Model *</label>
                    <input type="text" class="form-control" id="model" name="model" 
                           value="{{formData.model}}" required>
                </div>

                <div class="mb-3">
                    <label for="productName" class="form-label">Product Name *</label>
                    <input type="text" class="form-control" id="productName" name="productName" 
                           value="{{formData.productName}}" required>
                </div>

                <div class="mb-3">
                    <label for="productDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="productDescription" name="productDescription" 
                              rows="4">{{formData.productDescription}}</textarea>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="skiLength" class="form-label">Ski Length (cm)</label>
                        <input type="number" class="form-control" id="skiLength" name="skiLength" 
                               value="{{formData.skiLength}}">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="skiWidth" class="form-label">Ski Width (mm)</label>
                        <input type="number" class="form-control" id="skiWidth" name="skiWidth" 
                               value="{{formData.skiWidth}}">
                    </div>
                </div>

                <div class="mb-3">
                    <label for="price" class="form-label">Price ($) *</label>
                    <input type="number" step="0.01" class="form-control" id="price" name="price" 
                           value="{{formData.price}}" required>
                </div>

                <!-- IMAGE UPLOAD -->
                <div class="mb-3">
                    <label for="productImages" class="form-label">Product Images (Max 5)</label>
                    <input type="file" class="form-control" id="productImages" name="productImages" 
                           accept="image/*" multiple>
                    <div class="form-text">You can upload up to 5 images. First image will be the primary image.</div>
                </div>

                <div id="productImagePreview" class="mb-3 d-flex flex-wrap gap-2"></div>

                <button type="submit" class="btn btn-primary">Create Product Listing</button>
            </form>
        </div>

        <!-- SERVICE LISTING FORM -->
        <div class="tab-pane fade {{#if (eq listingType 'service')}}show active{{/if}}" 
             id="service" role="tabpanel">
            <form action="/create-listing/service" method="POST" enctype="multipart/form-data">
                
                <div class="mb-3">
                    <label for="serviceName" class="form-label">Service Name *</label>
                    <input type="text" class="form-control" id="serviceName" name="serviceName" 
                           value="{{formData.serviceName}}" required>
                </div>

                <div class="mb-3">
                    <label for="serviceDescription" class="form-label">Description</label>
                    <textarea class="form-control" id="serviceDescription" name="serviceDescription" 
                              rows="4">{{formData.serviceDescription}}</textarea>
                </div>

                <div class="mb-3">
                    <label for="servicePrice" class="form-label">Price ($)</label>
                    <input type="number" step="0.01" class="form-control" id="servicePrice" name="price" 
                           value="{{formData.price}}">
                </div>

                <!-- IMAGE UPLOAD -->
                <div class="mb-3">
                    <label for="serviceImages" class="form-label">Service Images (Max 5)</label>
                    <input type="file" class="form-control" id="serviceImages" name="serviceImages" 
                           accept="image/*" multiple>
                    <div class="form-text">You can upload up to 5 images. First image will be the primary image.</div>
                </div>

                <div id="serviceImagePreview" class="mb-3 d-flex flex-wrap gap-2"></div>

                <button type="submit" class="btn btn-primary">Create Service Listing</button>
            </form>
        </div>

    </div>
</div>

<script>
// Image preview for product images
document.getElementById('productImages')?.addEventListener('change', function(e) {
    const preview = document.getElementById('productImagePreview');
    preview.innerHTML = '';
    
    if (this.files.length > 5) {
        alert('Maximum 5 images allowed');
        this.value = '';
        return;
    }
    
    Array.from(this.files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'position-relative';
            div.innerHTML = `
                <img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover;" class="rounded">
                ${index === 0 ? '<span class="badge bg-primary position-absolute top-0 start-0">Primary</span>' : ''}
            `;
            preview.appendChild(div);
        };
        reader.readAsDataURL(file);
    });
});

// Image preview for service images
document.getElementById('serviceImages')?.addEventListener('change', function(e) {
    const preview = document.getElementById('serviceImagePreview');
    preview.innerHTML = '';
    
    if (this.files.length > 5) {
        alert('Maximum 5 images allowed');
        this.value = '';
        return;
    }
    
    Array.from(this.files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function(e) {
            const div = document.createElement('div');
            div.className = 'position-relative';
            div.innerHTML = `
                <img src="${e.target.result}" style="width: 100px; height: 100px; object-fit: cover;" class="rounded">
                ${index === 0 ? '<span class="badge bg-primary position-absolute top-0 start-0">Primary</span>' : ''}
            `;
            preview.appendChild(div);
        };
        reader.readAsDataURL(file);
    });
});
</script>
